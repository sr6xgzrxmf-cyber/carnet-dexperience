import type { Metadata, Viewport } from "next";
import Script from "next/script";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import SiteHeader from "@/components/SiteHeader";
import { SpeedInsights } from "@vercel/speed-insights/next";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Carnet dâ€™expÃ©rience",
  description:
    "Carnet dâ€™expÃ©rience â€” parcours, articles, mÃ©thodes et retours de terrain.",
  verification: {
    google: "pqYX0KqYycbGy3Bhid-rjOcJsUvGZ2cEgkk0y29iVWw",
  },
};

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
};

const siteUrl = "https://www.carnetdexperience.fr";

const siteJsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": `${siteUrl}/#website`,
      url: siteUrl,
      name: "Carnet dâ€™expÃ©rience",
      inLanguage: "fr-FR",
    },
    {
      "@type": "Person",
      "@id": `${siteUrl}/#laurent-guyonnet`,
      name: "Laurent Guyonnet",
      url: siteUrl,
      // Mets ici uniquement des URLs publiques solides si tu en as
      // sameAs: ["https://github.com/â€¦", "https://â€¦"],
    },
  ],
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="fr">
      <head>
        
        
        <script
          id="key-warning-trace"
          dangerouslySetInnerHTML={{
            __html: `
(function () {
  var origError = console.error;
  var origWarn = console.warn;

  function dump(method, args) {
    try {
      console.group("ðŸ”Ž key warning (" + method + ")");
      try { console.log("raw args:", args); } catch(e) {}
      for (var i = 0; i < args.length; i++) {
        if (typeof args[i] === "string") {
          console.log("arg[" + i + "]:\n" + args[i]);
        }
      }
      console.trace("js trace");
      console.groupEnd();
    } catch (e) {}
  }

  function wrap(name, orig) {
    return function () {
      try {
        var first = String(arguments[0] || "");
        if (first.indexOf('Each child in a list should have a unique "key" prop') !== -1 ||
            first.indexOf("warning-keys") !== -1) {
          dump(name, arguments);
        }
      } catch (e) {}
      return orig.apply(console, arguments);
    };
  }

  console.error = wrap("error", origError);
  console.warn  = wrap("warn", origWarn);
})();
`,
          }}
        />
{/* JSON-LD sitewide : WebSite + Person */}
        <Script
          id="jsonld-site"
          type="application/ld+json"
          strategy="afterInteractive"
          dangerouslySetInnerHTML={{ __html: JSON.stringify(siteJsonLd) }}
        />
      </head>

      <body
        className={[
          geistSans.variable,
          geistMono.variable,
          "bg-[var(--background)]",
          "text-[var(--foreground)]",
          "text-[15px] leading-[1.6]",
          "antialiased",
        ].join(" ")}
      >

        <Script
  id="key-warning-trace"
  strategy="beforeInteractive"
  dangerouslySetInnerHTML={{
    __html: `
(function () {
  var orig = console.error;
  console.error = function () {
    try {
      var msg = String(arguments[0] || "");
      if (msg.indexOf('Each child in a list should have a unique "key" prop') !== -1) {
        console.group("ðŸ”Ž key warning (beforeInteractive)");
        console.log("message:", arguments[0]);
        if (typeof arguments[1] === "string") console.log("component stack:\\n" + arguments[1]);
        console.trace("trace");
        console.groupEnd();
      }
    } catch (e) {}
    return orig.apply(console, arguments);
  };
})();
`,
  }}
/>
        <SiteHeader />

        <main className="site-container py-10 sm:py-14">{children}</main>

        <SpeedInsights />

      </body>
    </html>
  );
}